summary: Open source computer vision library
web-url: https://opencv.org/
git-url: https://github.com/opencv/opencv
src-url: https://github.com/opencv/opencv/archive/refs/tags/4.8.1.tar.gz
src-sha: 62f650467a60a38794d681ae7e66e3e8cfba38f445e0bf87867e2f2cdc8be9d5
license: Apache-2.0
dep-pkg: ffmpeg eigen3 tbb openexr openjpeg openblas
dep-upp: python3 android-sdk
dopatch: |
    # bundled third-party libraries are removed, we want to use our own
    for d in ffmpeg libjasper libjpeg libjpeg-turbo libpng libtiff libwebp openexr openjpeg tbb zlib
    do
        rm -rf "3rdparty/$d"
    done
install: |
    cmakew \
        -DCMAKE_CXX_STANDARD=17 \
        -DBUILD_SHARED_LIBS=OFF \
        -DBUILD_ANDROID_PROJECTS=OFF \
        -DBUILD_PERF_TESTS=OFF \
        -DBUILD_TESTS=OFF \
        -DBUILD_PROTOBUF=ON \
        -DBUILD_OPENJPEG=OFF \
        -DBUILD_OPENEXR=OFF \
        -DBUILD_JASPER=OFF \
        -DBUILD_JPEG=OFF \
        -DBUILD_TIFF=OFF \
        -DBUILD_WEBP=OFF \
        -DBUILD_ZLIB=OFF \
        -DBUILD_PNG=OFF \
        -DBUILD_TBB=OFF \
        -DBUILD_opencv_hdf=OFF \
        -DBUILD_opencv_java=OFF \
        -DBUILD_opencv_text=ON \
        -DBUILD_opencv_python2=OFF \
        -DBUILD_opencv_python3=ON \
        -DWITH_GSTREAMER=OFF \
        -DWITH_OPENVINO=OFF \
        -DWITH_OPENEXR=ON \
        -DWITH_GPHOTO2=OFF \
        -DWITH_JASPER=OFF \
        -DWITH_OPENGL=ON \
        -DWITH_FFMPEG=ON \
        -DWITH_EIGEN=ON \
        -DWITH_1394=OFF \
        -DWITH_CUDA=OFF \
        -DWITH_TBB=ON \
        -DWITH_VTK=ON \
        -DWITH_QT=OFF \
        -DPROTOBUF_UPDATE_FILES=OFF \
        -DOPENCV_ENABLE_NONFREE=OFF \
        -DOPENCV_GENERATE_PKGCONFIG=ON \
        -DOPENCV_SKIP_CMAKE_CXX_STANDARD=ON \
        -DANDROID_NO_TERMUX=OFF \
        -DANDROID_SDK_ROOT="$(uppm info android-sdk installed-dir)"
    run cp -r "$PACKAGE_INSTALL_DIR/sdk/native/jni/include" "$PACKAGE_INSTALL_DIR/"
    run cp -r "$PACKAGE_INSTALL_DIR/sdk/native/*/$TARGET_PLATFORM_ABI" "$PACKAGE_INSTALL_DIR/lib"
