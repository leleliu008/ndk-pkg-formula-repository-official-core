pkgtype: bin
summary: Compression and file packaging/archive utility
web-url: https://infozip.sourceforge.io/Zip.html

src-url: https://downloads.sourceforge.net/project/infozip/Zip%203.x%20%28latest%29/3.0/zip30.tar.gz
src-sha: f0e8bb1f9b7eb0b01285495a2699df3a4b766784c1765a8f1aeedf63c0806369

# https://packages.debian.org/sid/zip
fix-url: https://deb.debian.org/debian/pool/main/z/zip/zip_3.0-13.debian.tar.xz
fix-sha: 4f5aca2d9f6021d2fd73f2fc16e9a392ab98673a940b44cf78fe38b8cdec1ab9

version: 3.0.11

license: Info-ZIP
dep-pkg: libbz2
binbstd: 1
dep-upp: patch
dopatch: |
    for patchfile in $(cat ../fix/patches/series)
    do  
        patch -p1 < ../fix/patches/$patchfile || return 1
    done

    sed_in_place 's|$(AS) _match.s|$(AS) -o _match.o _match.s|'          unix/Makefile
    sed_in_place 's|$(AS) _crc_i386.s|$(AS) -o _crc_i386.o _crc_i386.s|' unix/Makefile

    sed_in_place '/memset OF((/c char *memset OF((char *, int, size_t));'    zip.h
    sed_in_place '/memcpy OF((/c char *memcpy OF((char *, char *, size_t));' zip.h
    sed_in_place '/memcmp OF((/c int memcmp OF((char *, char *, size_t));'   zip.h
ccflags: -Wno-implicit-function-declaration
install: |
    gmakew -f unix/Makefile clean
    gmakew -f unix/Makefile generic \
        CC="$CC" \
        CPP="'$CPP'" \
        AS="$AS" \
        AR="$AR" \
        LOCAL_ZIP="'$CFLAGS $CPPFLAGS'" \
        LFLAGS2="'$LDFLAGS'"
    gmakew -f unix/Makefile install \
        prefix="$PACKAGE_INSTALL_DIR" \
        MANDIR="$PACKAGE_INSTALL_DIR/share/man/man1"
